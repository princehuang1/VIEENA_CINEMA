<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="movie_project.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="2791"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="Movies" custom_title="0" dock_id="1" table="4,6:mainMovies"/><dock_state state="000000ff00000000fd00000001000000020000033c000002abfc0100000001fb000000160064006f0063006b00420072006f007700730065003101000000000000033c0000012500ffffff000002790000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="BookedSeats" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="73"/><column index="2" value="60"/><column index="3" value="67"/><column index="4" value="65"/><column index="5" value="72"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Movies" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="48"/><column index="2" value="300"/><column index="3" value="118"/><column index="4" value="85"/><column index="5" value="300"/><column index="6" value="195"/><column index="7" value="300"/><column index="8" value="83"/><column index="9" value="296"/><column index="10" value="117"/><column index="11" value="93"/><column index="12" value="300"/><column index="13" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Theaters" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="51"/><column index="2" value="69"/><column index="3" value="195"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">-- 1. 清空舊資料 (確保不會重複)
DELETE FROM Showtimes;
DELETE FROM sqlite_sequence WHERE name='Showtimes';
DELETE FROM Theaters;
DELETE FROM sqlite_sequence WHERE name='Theaters';

-- 2. 建立 3 大影城
INSERT INTO Theaters (theaterName, seatLayout) VALUES 
('台北信義影城', '{&quot;rows&quot;: 15, &quot;cols&quot;: 20}'),
('台北中山影城', '{&quot;rows&quot;: 12, &quot;cols&quot;: 18}'),
('新北板橋影城', '{&quot;rows&quot;: 20, &quot;cols&quot;: 25}');

-- 3. 自動生成未來 30 天的場次 (使用遞迴查詢)
-- 邏輯：每天固定 5 個時段，3 間影城都播前 15 部電影
INSERT INTO Showtimes (movieId, theaterId, showtimeStartTime)
WITH RECURSIVE 
  -- (A) 產生 0 到 29 的數字 (代表未來 30 天)
  Next30Days(dayOffset) AS (
    SELECT 0
    UNION ALL
    SELECT dayOffset + 1 FROM Next30Days WHERE dayOffset &lt; 29
  ),
  -- (B) 定義每天固定的 5 個時段
  DailyTimes(timeStr) AS (
    VALUES ('10:30'), ('13:15'), ('15:40'), ('18:20'), ('21:00')
  ),
  -- (C) 選取前 15 部電影
  Top15Movies AS (
    SELECT movieId FROM Movies ORDER BY movieId LIMIT 15
  )
-- (D) 將上述三個表進行「交叉連接 (Cross Join)」生成所有組合
SELECT 
  m.movieId,
  t.theaterId,
  -- 組合日期時間字串: YYYY-MM-DD HH:MM:00
  date('now', '+' || d.dayOffset || ' days', 'localtime') || ' ' || dt.timeStr || ':00'
FROM Top15Movies m
CROSS JOIN Theaters t
CROSS JOIN Next30Days d
CROSS JOIN DailyTimes dt;

-- 驗證：顯示生成的筆數
SELECT '已成功生成 ' || COUNT(*) || ' 筆場次資料' as Result FROM Showtimes;</sql><current_tab id="0"/></tab_sql></sqlb_project>
